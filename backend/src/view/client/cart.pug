include ./layouts/header.pug
include ./layouts/nav.pug

main
  section
    .container
      .row.mt-5
        .col-md-7
          .card
            .card-body
              h4 Cart
              hr
              if cart
                for item, index in cart
                  .media.mb-3
                    img.mr-2(src="https://via.placeholder.com/125x125")
                    .media-body.h-100
                      .d-flex.justify-content-between
                        p.lead.m-0=item.name
                        p.text-secondary.m-0= '$' + item.price
                      .form-inline.text-secondary
                        .form-group
                          label(for="size").mr-2 Size:
                          select.custom-select.custom-select-sm(name="size").mr-3
                            each size, index in item.sizes
                              - if(index === item.size) {
                                  option(value=index selected)= size
                              - }
                              - else {
                                  option(value=index)= size
                              - }
                        .form-group.text-secondary
                          label(for="quan").mr-2 Quantity:
                          select.custom-select.custom-select-sm(name="quan").mr-3
                            -for(let i = 0 ; i < 5 ; i++) {
                              - if(item.quan = i) {
                                option(value=i + selected)= (i + 1) +' Pieces'
                              - }
                              - else {
                                option(value=i)= (i + 1) + ' Pieces'
                              - }
                            - }
                      button.btn.btn-danger.btn-sm(onClick=`RemoveItem(${index})`) Remove
        .col-md-5
          .card.bg-dark.text-white
            .card-body
              h4.font-weight-bold Summary
              hr.border-white.mb-4
              .d-flex.justify-content-between
                p Subtotal
                if price
                  p.font-weight-bold= '$' + price.subtotal
                else
                  p.font-weight-bold= '$' + 0.00
              .d-flex.justify-content-between
                p Estimated Shipping & Handling
                if price
                  p.font-weight-bold= '$' + price.shipFee
                else
                  p.font-weight-bold= '$' + 0.00
              .d-flex.justify-content-between
                p Estimated Tax
                if price
                  p.font-weight-bold= '$' + price.taxFee
                else
                  p.font-weight-bold= '$' + 0.00
              .d-flex.justify-content-between.mt-2
                p.lead Total
                if price
                  p.lead= '$' + price.total
                else
                  p.lead= '$' + 0.00
              a.btn.btn-primary.btn-block
                i.fab.fa-paypal
                | Pay with PayPal
              
include ./layouts/footer.pug

script.
  const RemoveItem = async (index) =>
  {
    const res = await axios({
      method: 'delete',
      url: `/cart?remove=${index}`
    });
    if(res.data.success)
    {
      alert("The item has successfully been deleted");
      location.reload();
    }
    else 
    {
      alert("The item has unsuccessfully been deleted");
    }
  }
  
  const UpdateQuanOrSize = async () =>
  {
    const res = await axios({
      method: 'put',
      url: `/cart?id=${id}&size=${size}&quan=${quan}`
    });
    if(res.data.success)
    {
      alert("The item was successfully modified");
      location.reload();
    }
    else {
      alert("The item was unsuccessfully deleted");
    }
  }

  