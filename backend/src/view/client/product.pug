include ./layouts/header.pug
include ./layouts/nav.pug

main
  section
    .container
      .row
        .col-md-8
          .row.no-gutters.sticky-top
            .col-6.text-center
              - for(let i = 0 ; i< product.images.length;i++) {
                - if(!(i % 2)) {
                    img.img-fluid.p-1(src=product.images[i] alt="placeholder")
                    br
                - }
              - }
            .col-6.text-center
              - for(let i = 0 ; i< product.images.length;i++) {
                - if((i % 2)) {
                    img.img-fluid.p-1(src=product.images[i] alt="placeholder")
                    br
                - }
              - }
        .col-md-4
          h2#title= product.name
          p.small.mb-2= 'by ' + product.brand
          .d-flex.align-items-center
            span.mr-2= product.rating
            - for(var i = 0 ; i < product.rating.toFixed(0) ; i++)
                i.fas.fa-star.text-warning
            - var ratingHalf = product.rating - product.rating.toFixed(0)
            if (ratingHalf)
              i.fas.fa-star-half.text-warning
          hr
          if product.warning
            .alert.alert-danger
              ='[WARNING!] ' + product.warning
          p.text-secondary.my-2= 'Price: ' 
            span.text-primary.font-weight-bold= '$' + product.price
          if product.stock
            p.text-success.my-2 In Stock
          else
            p.text-warning.my-2 Unavaliable
          .card.my-3
            .card-body
              .form-group
                label(for="size") Size:
                select.custom-select-sm.custom-select#size(name="size")
                  each size, index in product.sizes
                      option(value=index)= size
              .form-group
                label(for="quan") Quantity:
                select.custom-select-sm.custom-select#quan(name="quan")
                  option(value="1") 1
                  option(value="2") 2
                  option(value="3") 3
                  option(value="4") 4
                  option(value="5") 5
              .form-group
                button.btn.btn-primary.btn-block(onclick="AddToCart()")
                  i.fas.fa-cart-plus.mr-2
                  | Add to cart
                button.btn.btn-primary.btn-block(onclick="BuyNow()")
                  i.fas.fa-play.mr-2
                  | Buy Now
          h4 Desciption
          hr
          p.my-2= product.description
          h4 Direction
          hr
          ul.list-group
            each direction, index in product.directions
              li.list-group-item=(index + 1) + '. ' + direction
          h4 Ingredients
          hr
          ul.list-group
            each ingredient, index in product.ingredients
              li.list-group-item= (index + 1) + '. ' +  ingredient
          h4 Benefits
          hr
          ul.list-group
            each benefit, index in product.benefits
              li.list-group-item= (index + 1) + '. ' + benefit

include ./layouts/footer.pug

script.
  const AddToCart = async () => {
    const urlParams = new URLSearchParams(window.location.search);
    const uuid = urlParams.get('id');
    const size = document.querySelector('#size');
    const quan = document.querySelector('#quan');
    const title = document.querySelector('#title').textContent;
    const sizeVal = size.options[size.selectedIndex].value;
    const sizeText = size.options[size.selectedIndex].innerHTML;
    const quanVal = quan.options[quan.selectedIndex].value;
    if(!uuid) 
    {
      alert('Unable find the id of the product, please try again');
      return;
    }
    const res = await axios({
      method: 'put',
      url: `/cart?add=${uuid}&quan=${quanVal}&size=${sizeVal}`
    });
    if(res.data.success === true) 
    {
      alert(`${quanVal} ${title}(${sizeText}) has been added to the cart`);
      return true;
    }
    else
    {
      alert(`Cannot successfully enter the ${quanVal} ${title}(${sizeText}) into the cart.`);
      return false;
    } 
  }
  const BuyNow = async () => {
    const success = await AddToCart();
    if(success) window.location.pathname = "/cart";
  }